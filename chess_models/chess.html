<!DOCTYPE html>
<html>
	<head>
		<title>chess</title>
		<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
		<script src="database.js"></script>
		<style>
			body{
				overflow: hidden;
				margin: 0px 0px;
			}
			
			.chessCell{
				text-align: left;
				color: blue;
				border: 1px solid black;
				width: 12.5vh;
				height: 12.5vh;
				background-repeat: no-repeat;
				background-position: center center;
				background-size: 50% 50%;
				box-sizing: border-box;
			}
		</style>
		<script>
			function initialize(){
				$("#chessBoard").css("border","1px solid black").css("border-collapse","collapse");
				updateChessBoard();
				
				playerCanMove = true; // set to true for now but you will need to change it when you add in turns
				
				selectionPhase = 0; // phase 0 is when u r picking a piece, 1 is for when u are moving the piece to a new spot
			}
			// ERROR
			function updateChessBoard(){
				cellsOccupiedByPieces = []; // this array tells you which cell numbers (1 ~ 64) are occupied by a chess piece
				cellsOccupants = []; // this array tells you which piece from chessBoardData is in each occupied cell
				
				/*
					lets say the first item of cellsOccupiedByPieces is 16.
					this means there is a chess piece at cell 13 on the chessBoard. let's say this chess piece is blackPawn_8
					
					the first item of cellsOccupants is the index of blackPawn_8's object in the chessBoardData array.
				*/
				
				for (var index=0; index<chessBoardData.length; index++){
					// find all the chess pieces that are alive. if they are alive, they are obviously somewhere on the board
					// chessBoardData[index].cell() is the cell number occupied by each piece
					if (chessBoardData[index].alive){
						cellsOccupiedByPieces.push(chessBoardData[index].cell());
						cellsOccupants.push(index);
					}
				}
				var imageSrcs = [];
				for (var index=1; index<65; index++){
					// if the cell is supposed to be occupied by a piece, it's background image to that piece's image
					// if the cell is not occupied by anything, then its background image will be nothing
					if (cellsOccupiedByPieces.includes(index))
						imageSrcs.push(chessBoardData[cellsOccupants[cellsOccupiedByPieces.indexOf(index)]].image);
					else
						imageSrcs.push("none");
				}
				$("#chessBoard").empty(); // delete the whole chess board
				for (var row=1; row<9; row++){
					$("#chessBoard").append($("<tr>").attr("id","row" + row));
					for (var column=1; column<9; column++){
						$("#row" + row).append($("<td>")
							.attr("valign","top")
							.attr("class","chessCell")
							.attr("onclick","selectCell(" + row + "," + column + ");")
							.css("background-image",imageSrcs[((row - 1) * 8) + column - 1]) // physically applying background image
							// background image will be the only way for you to physically tell where each piece is
							.html(((row - 1) * 8) + column)
						);
					}
				}
			}
			
			function selectCell(row, column){
				if (playerCanMove){
					if (selectionPhase === 0){
						// conditions for if you can select a piece
						// currently, the only condition is that the cell must have a piece in  it
						// in the future u may want to add another condition that can only allow the king piece to move if he is in danger
						var cellContainsPiece = cellsOccupiedByPieces.includes(((row - 1) * 8) + column);
						var condition2 = true;
						var condition3 = true;
						
						if (cellContainsPiece && condition2 && condition3){
							currentCell = [row, column];
							selectionPhase++;
						} else {
							alert("this cell does not have any chess piece to be selected");
						}
					} else {
						// conditions for where a sleected piece can go. add more if needed
						// example of condition: if the new destination not taken by your side's pieces? if yes, you can mvoe there. if not, u can't move there because u cant eat yourself
						var isNewDestination = (row != currentCell[0]) || (column != currentCell[1]);
						var condition2 = true;
						var condition3 = true;
						
						if (isNewDestination && condition2 && condition3)
							movePiece(currentCell,[row, column]);
						else 
							alert("the selected piece is already at this cell");
					}
				}
			}
			
			function movePiece(originalCoordinates, newCoordinates){
				// find the index of the sleected piece inside the chessBoardData array
				var currentPiece = cellsOccupants[cellsOccupiedByPieces.indexOf(((originalCoordinates[0] - 1) * 8) + originalCoordinates[1])];
				
				// change the selected piece's row and column
				chessBoardData[currentPiece].row = newCoordinates[0];
				chessBoardData[currentPiece].column = newCoordinates[1];
				
				// check to see if the selected piece's new destination was occupied by another chess piece
				// if there was another chess piece, then that chess piece will be declared dead
				if (cellsOccupiedByPieces.includes(((newCoordinates[0] - 1) * 8) + newCoordinates[1])){
					var chessBoardTargetIndex = cellsOccupants[cellsOccupiedByPieces.indexOf(((newCoordinates[0] - 1) * 8) + newCoordinates[1])];
					chessBoardData[chessBoardTargetIndex].row = null;
					chessBoardData[chessBoardTargetIndex].column = null;
					chessBoardData[chessBoardTargetIndex].alive = false;
				}
				selectionPhase--; // once a piece is moved, selectionPhase gets set back to 0 so the user can pick another chess piece to move
				updateChessBoard();
			}
		</script>
	</head>
	<body onload="initialize();">
		<table id="chessBoard"></table>
	</body>
</html>